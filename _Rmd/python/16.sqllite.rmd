---
layout: post
title: "[Python] sqlite"
date: "2018-10-01"
excerpt: "파이썬에서 쿼리문을 사용해보자"
output: github_document
tag:
    [python, sqlite]
comments: true
categories:
  Python
---


```{r setup, include = FALSE}
library(reticulate)
use_python("/Users/Deokhee/anaconda/bin/")
```

## sqlite

`sqlite`는 별도의 db서버가 필요 없이 db 파일에 기초하여 데이터베이스를 처리하는 엔진이다. 기본적인 사용법을 알아보자.

```{python, error=TRUE}
import sqlite3

conn = sqlite3.connect(":memory:") # memory에 db를 구성할 수 있도록 
c = conn.cursor() # pointer 지정
c.execute("create table emp(id integer, name text, sal integer)") # 데이터를 저장할 수 있는 테이블 구성

# data insert
c.execute("insert into emp(id, name, sal) values(1,'Jobs',1000)")
c.execute("select * from emp") 

# sqlite는 메모리에 대한 정보만 출력된다. 그래서 fetch를 해주어서 확인해야 한다.

print(c.fetchone()) # 1줄 패치

c.execute("insert into emp(id, name, sal) values(2,'Bezos',2000)")
c.execute("select * from emp")
print(c.fetchone())
print(c.fetchone())

c.execute("select * from emp") 
print(c.fetchall()) # 한꺼번에 패치

# cursor와 connect 닫으면 data들은 사라지게 된다.
c.close() 
conn.close()

# data들이 사라지는지 확인해보자
conn= sqlite3.connect(":memory:")
c = conn.cursor()
c.execute("select * from emp") 
print(c.fetchall())

# 확인차 열어 둔 cursor와 connect를 닫아주자
c.close() 
conn.close()
```

`insert`는 transaction이 발생한다. 그래서 `rollback`과 `commit`을 선언할 수 있다.

```{python}
import sqlite3

conn = sqlite3.connect(":memory:") 
c = conn.cursor()
c.execute("create table emp(id integer, name text, sal integer)")
c.execute("insert into emp(id, name, sal) values(1,'Jobs',1000)")
c.execute("insert into emp(id, name, sal) values(2,'Bezos',2000)")
c.execute("select * from emp")
print(c.fetchall())

# rollback 선언
conn.rollback() 
c.execute("select * from emp") 
print(c.fetchall())

c.execute("insert into emp(id, name, sal) values(1,'Jobs',1000)")
c.execute("insert into emp(id, name, sal) values(2,'Bezos',2000)")

# commit 선언
conn.commit()
c.execute("select * from emp") 
print(c.fetchall())

c.close() 
conn.close()
```


